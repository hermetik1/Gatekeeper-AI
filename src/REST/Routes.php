<?php
namespace AIPM\REST; use AIPM\Support\Options; use AIPM\Support\Capabilities; class Routes{ public static function register(): void { register_rest_route('aipm/v1','/settings',[ ['methods'=>'GET','permission_callback'=>[self::class,'can_manage'],'callback'=>function(){ return Options::get(); }], ['methods'=>'POST','permission_callback'=>[self::class,'can_manage'],'callback'=>function($req){ $data=$req->get_json_params()?:[]; if(!is_array($data)) $data=[]; Options::update($data); return Options::get(); }] ]); register_rest_route('aipm/v1','/bots',[ 'methods'=>'GET','permission_callback'=>[self::class,'can_manage'],'callback'=>function(){ return \AIPM\Policies\BotDirectory::list(); } ]); } public static function can_manage(): bool { return Capabilities::can_manage() && is_user_logged_in(); } }
