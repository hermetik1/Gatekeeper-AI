<?php
namespace AIPM\Admin\MetaBoxes; use AIPM\Support\Capabilities; class PostPolicyMetaBox{ public static function register(): void { $pts=get_post_types(['public'=>true],'names'); foreach($pts as $pt){ add_meta_box('gkai_policy',__('Gatekeeper AI Policy','gatekeeper-ai'),[self::class,'render'],$pt,'side','default'); } } public static function render($post): void { if(!Capabilities::can_manage()) return; $value=get_post_meta($post->ID,'_gkai_policy',true)?:'default'; wp_nonce_field('gkai_policy_meta','_gkai_nonce'); echo '<p><label for="gkai_policy">'.esc_html__('AI Access','gatekeeper-ai').'</label></p>'; echo '<select id="gkai_policy" name="gkai_policy">'; foreach(['default','allow','block'] as $opt){ printf('<option value="%s"%s>%s</option>', esc_attr($opt), selected($value,$opt,false), esc_html(ucfirst($opt))); } echo '</select>'; } public static function save($post_id): void { if(!isset($_POST['_gkai_nonce']) || !wp_verify_nonce($_POST['_gkai_nonce'],'gkai_policy_meta')) return; if(!Capabilities::can_manage()) return; if(defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) return; $val=isset($_POST['gkai_policy'])?sanitize_text_field($_POST['gkai_policy']):'default'; update_post_meta($post_id,'_gkai_policy',$val); } }
